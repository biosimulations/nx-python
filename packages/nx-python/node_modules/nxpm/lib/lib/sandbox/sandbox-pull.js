"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const cli_ux_1 = require("cli-ux");
const utils_1 = require("../../utils");
const sandbox_utils_1 = require("./utils/sandbox-utils");
const pull = async (config) => {
    const existing = await sandbox_utils_1.getDockerImages();
    const sandboxes = await sandbox_utils_1.getSandboxUrlCache(config);
    const filtered = config.remove ? sandboxes : sandboxes.filter((s) => !existing.includes(s.name));
    if (config.remove) {
        cli_ux_1.cli.action.start(`Remove ${filtered.length} Docker images ${config.force ? '(FORCED)' : null}`);
        for (let sandbox of filtered) {
            cli_ux_1.cli.action.status = sandbox.name;
            try {
                await sandbox_utils_1.removeDockerImage(sandbox.name, config.force);
            }
            catch (e) { }
        }
        cli_ux_1.cli.action.stop();
    }
    if (filtered.length) {
        cli_ux_1.cli.action.start(`Pulling ${filtered.length} Docker images`);
        for (let sandbox of filtered) {
            cli_ux_1.cli.action.status = sandbox.name;
            try {
                await sandbox_utils_1.pullDockerImage(sandbox.name);
            }
            catch (e) {
                utils_1.error(e.message);
            }
        }
        cli_ux_1.cli.action.stop();
    }
    else {
        utils_1.log('SANDBOX:PULL', 'Nothing to pull, you are all in sync!');
    }
};
exports.sandboxPull = async (config) => {
    await sandbox_utils_1.sandboxUrlCache(config);
    await pull(config);
};
